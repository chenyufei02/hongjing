<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="~{layout :: common_head('客户盈亏排行', ~{})}" />
</head>

<body>

<div th:replace="~{layout :: navbar}"></div>
<div th:replace="~{layout :: sidebar(${activeUri})}"></div>

<div class="main-content">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="h4">客户盈亏排行榜</h2>
        </div>

        <form th:action="@{/profitloss/list}" method="get" class="mb-4">
            <div class="row g-3 align-items-center">
                <div class="col-md-3">
                    <label>
                        <input type="text" name="customerName" class="form-control" placeholder="输入客户姓名进行筛选..." th:value="${customerName}">
                    </label>
                </div>
                <div class="col-md-9">
                    <button type="submit" class="btn btn-primary me-2">查询</button>
                    <a th:href="@{/profitloss/list}" class="btn btn-outline-secondary">重置</a>
                </div>
            </div>
        </form>

        <div class="card">
            <div class="card-body">
                <table class="table table-hover table-profit-loss">
                    <thead>
                    <tr>
                        <th>
                            <a class="table-sort-link" th:href="@{/profitloss/list(page=${statsPage.current}, size=${statsPage.size}, customerName=${customerName}, sortField='customerId', sortOrder=${sortField == 'customerId' ? reversedSortOrder : 'asc'})}">
                                客户姓名 (ID)
                                <span th:if="${sortField == 'customerId'}" th:text="${sortOrder == 'asc' ? '▲' : '▼'}"></span>
                            </a>
                        </th>
                        <th>累计投资</th>
                        <th>
                            <a class="table-sort-link" th:href="@{/profitloss/list(page=${statsPage.current}, size=${statsPage.size}, customerName=${customerName}, sortField='totalMarketValue', sortOrder=${sortField == 'totalMarketValue' ? reversedSortOrder : 'desc'})}">
                                当前总市值
                                <span th:if="${sortField == 'totalMarketValue'}" th:text="${sortOrder == 'asc' ? '▲' : '▼'}"></span>
                            </a>
                        </th>
                        <th>
                            <a class="table-sort-link" th:href="@{/profitloss/list(page=${statsPage.current}, size=${statsPage.size}, customerName=${customerName}, sortField='totalProfitLoss', sortOrder=${sortField == 'totalProfitLoss' ? reversedSortOrder : 'desc'})}">
                                总盈亏
                                <span th:if="${sortField == 'totalProfitLoss'}" th:text="${sortOrder == 'asc' ? '▲' : '▼'}"></span>
                            </a>
                        </th>
                        <th>
                             <a class="table-sort-link" th:href="@{/profitloss/list(page=${statsPage.current}, size=${statsPage.size}, customerName=${customerName}, sortField='profitLossRate', sortOrder=${sortField == 'profitLossRate' ? reversedSortOrder : 'desc'})}">
                                总盈亏率
                                <span th:if="${sortField == 'profitLossRate'}" th:text="${sortOrder == 'asc' ? '▲' : '▼'}"></span>
                            </a>
                        </th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr th:if="${not #lists.isEmpty(statsPage.records)}" th:each="stat : ${statsPage.records}">
                            <td>
                                <div th:text="${stat.customerName}"></div>
                                <small class="text-muted" th:text="'ID: ' + ${stat.customerId}"></small>
                            </td>
                            <td th:text="${#numbers.formatDecimal(stat.totalInvestment, 1, 2)}"></td>
                            <td th:text="${#numbers.formatDecimal(stat.totalMarketValue, 1, 2)}"></td>
                            <td>
                                <span th:text="${#numbers.formatDecimal(stat.totalProfitLoss, 1, 2)}"
                                      th:class="${stat.totalProfitLoss != null and stat.totalProfitLoss > 0 ? 'text-profit fw-bold' : 'text-loss fw-bold'}"></span>
                            </td>
                            <td>
                                <span th:text="${#numbers.formatDecimal(stat.profitLossRate, 1, 2)} + '%'"
                                      th:class="${stat.profitLossRate != null and stat.profitLossRate > 0 ? 'text-profit fw-bold' : 'text-loss fw-bold'}"></span>
                            </td>
                            <td>
                                <a class="btn btn-sm btn-outline-primary"
                                   th:href="@{/customer/detail/{id}(id=${stat.customerId}, returnUrl=${#request.getRequestURI() + '?' + #request.getQueryString()})}">查看详情</a>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(statsPage.records)}">
                            <td colspan="6" class="text-center p-4">没有找到符合条件的客户盈亏数据。</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div th:if="${statsPage.pages > 0}" class="card-footer d-flex justify-content-center align-items-center">
                <nav aria-label="Page navigation" th:if="${statsPage.pages > 1}">
                    <ul class="pagination mb-0">
                        <li class="page-item" th:classappend="${statsPage.current == 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/profitloss/list(page=${statsPage.current - 1}, size=${statsPage.size}, customerName=${customerName}, sortField=${sortField}, sortOrder=${sortOrder})}">&laquo;</a>
                        </li>
                        <li class="page-item" th:each="pageNum : ${#numbers.sequence(startPage, endPage)}" th:classappend="${pageNum == statsPage.current} ? 'active'">
                            <a class="page-link" th:href="@{/profitloss/list(page=${pageNum}, size=${statsPage.size}, customerName=${customerName}, sortField=${sortField}, sortOrder=${sortOrder})}" th:text="${pageNum}"></a>
                        </li>
                        <li class="page-item" th:classappend="${statsPage.current == statsPage.pages} ? 'disabled'">
                             <a class="page-link" th:href="@{/profitloss/list(page=${statsPage.current + 1}, size=${statsPage.size}, customerName=${customerName}, sortField=${sortField}, sortOrder=${sortOrder})}">&raquo;</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

    </div>
</div>


</body>
</html>